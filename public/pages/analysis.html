<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hand History - PokerGeek.ai</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;800&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/pokergeek.css">
    <link rel="stylesheet" href="/css/index-modern.css">
    <link rel="stylesheet" href="/css/hand-history.css">
    
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Unified Auth System -->
    <script src="/js/auth-manager.js"></script>
    <script src="/js/nav-shared.js"></script>
    <script src="/js/navbar-template.js"></script>
    
    <!-- Hand Encoder for decoding -->
    <script src="/js/hand-encoder.js"></script>
    
    <!-- Analytics Components -->
    <script src="/js/analytics-components.js"></script>
    
    <!-- Liquid Glass SVG Filter -->
    <svg xmlns="http://www.w3.org/2000/svg" width="0" height="0" style="position:absolute; overflow:hidden">
      <defs>
        <filter id="glass-distortion" x="0%" y="0%" width="100%" height="100%">
          <feTurbulence type="fractalNoise" baseFrequency="0.008 0.008" numOctaves="2" seed="92" result="noise" />
          <feGaussianBlur in="noise" stdDeviation="2" result="blurred" />
          <feDisplacementMap in="SourceGraphic" in2="blurred" scale="39" xChannelSelector="R" yChannelSelector="G" />
        </filter>
      </defs>
    </svg>
</head>
<body>
    <!-- UNIFIED NAVBAR -->
    <div id="navbar-container"></div>

    <!-- Main Content -->
    <main class="hand-history-page">
        <div class="hand-history-hero">
            <h1 class="hand-history-title">Analytics</h1>
            <p class="hand-history-subtitle">Your poker performance at a glance</p>
        </div>
        
        <div class="hand-history-container">
            <!-- Stats Dashboard -->
            <div id="stats-dashboard" class="stats-dashboard">
                <div class="loading-state">
                    <div class="loading-spinner"></div>
                    <p>Loading stats...</p>
                </div>
            </div>

            <!-- Filters -->
            <div class="hand-filters">
                <div class="filter-group">
                    <label>Filter</label>
                    <select id="hand-filter-dropdown" class="filter-select">
                            <option value="">All Hands</option>
                        <option value="won">Won</option>
                        <option value="lost">Lost</option>
                            <option value="big-pot">Big Pots ($500+)</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Sort</label>
                    <select id="hand-sort-dropdown" class="filter-select">
                        <option value="recent">Most Recent</option>
                        <option value="oldest">Oldest First</option>
                        <option value="pot-size">Largest Pot</option>
                        </select>
                    </div>
                </div>
                    
                    <!-- Hand List -->
            <div id="hand-history-list" class="hand-list">
                <div class="loading-state">
                    <div class="loading-spinner"></div>
                    <p>Loading your hands...</p>
                </div>
                    </div>
                    
                    <!-- Pagination -->
            <div id="history-pagination" class="hand-pagination">
                <button id="btn-prev" class="pagination-btn" disabled>‚Üê Previous</button>
                <span id="page-info" class="pagination-info">Page 1 of 1</span>
                <button id="btn-next" class="pagination-btn">Next ‚Üí</button>
            </div>
        </div>
    </main>

    <script>
        // ============================================
        // HAND HISTORY PAGE - SIMPLIFIED
        // ============================================
        
        let currentUser = null;
        let currentPage = 1;
        let currentFilters = {};
        let currentSort = 'recent';
        let allHands = []; // Store hands for quick lookup
        let profileStats = null;
        
        // Initialize
        document.addEventListener('DOMContentLoaded', async () => {
            // Wait for auth
            await new Promise(resolve => {
                const checkAuth = setInterval(() => {
                    if (window.authManager && window.authManager.user) {
                        clearInterval(checkAuth);
                        resolve();
                    }
                }, 100);
            });
            
            currentUser = window.authManager.user;
            
            if (!currentUser || !currentUser.id) {
                const container = document.getElementById('hand-history-list');
                if (container) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">üîê</div>
                            <h3>Please log in</h3>
                            <p>Sign in to view your hand history</p>
                        </div>
                    `;
                }
                return;
            }
            
            // Setup filter handlers (before loading, so they're ready)
            const filterDropdown = document.getElementById('hand-filter-dropdown');
            const sortDropdown = document.getElementById('hand-sort-dropdown');
            const btnPrev = document.getElementById('btn-prev');
            const btnNext = document.getElementById('btn-next');
            
            if (filterDropdown) {
                filterDropdown.addEventListener('change', async (e) => {
                    console.log('Filter changed:', e.target.value);
                    currentFilters = {};
                    if (e.target.value === 'won') {
                        currentFilters.won = true;
                    } else if (e.target.value === 'lost') {
                        currentFilters.lost = true;
                    } else if (e.target.value === 'big-pot') {
                        currentFilters.bigPot = true;
                    }
                    currentPage = 1;
                    await loadHandHistory();
                });
            } else {
                console.error('Filter dropdown not found!');
            }
            
            if (sortDropdown) {
                sortDropdown.addEventListener('change', async (e) => {
                    console.log('Sort changed:', e.target.value);
                    currentSort = e.target.value;
                    await loadHandHistory();
                });
            } else {
                console.error('Sort dropdown not found!');
            }
            
            if (btnPrev) {
                btnPrev.addEventListener('click', async () => {
                    if (currentPage > 1) {
                        currentPage--;
                        await loadHandHistory();
        }
                });
            }
            
            if (btnNext) {
                btnNext.addEventListener('click', async () => {
                    currentPage++;
                    await loadHandHistory();
                });
            }
            
            // Load stats and hands
            await Promise.all([
                loadProfileStats(),
                loadHandHistory()
            ]);
        });
        
        async function loadProfileStats() {
            const dashboard = document.getElementById('stats-dashboard');
            const token = await window.authManager?.getAccessToken();
            
            if (!token) {
                dashboard.innerHTML = '<div class="empty-state"><div class="empty-icon">üîê</div><h3>Authentication required</h3></div>';
                return;
            }
            
            try {
                const response = await fetch('/api/social/profile/me', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (!response.ok) throw new Error('Failed to fetch stats');
                
                const profile = await response.json();
                profileStats = profile;
                
                // Get friend count separately if needed
                let friendCount = 0;
                try {
                    const friendsResponse = await fetch('/api/social/friends', {
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    if (friendsResponse.ok) {
                        const friendsData = await friendsResponse.json();
                        friendCount = friendsData.friends?.length || 0;
            }
                } catch (e) {
                    console.warn('Failed to fetch friend count:', e);
        }

                dashboard.innerHTML = renderStatsDashboard(profile, friendCount);
            } catch (error) {
                console.error('Error loading stats:', error);
                dashboard.innerHTML = '<div class="empty-state"><div class="empty-icon">‚ö†Ô∏è</div><h3>Failed to load stats</h3></div>';
            }
        }
        
        function renderStatsDashboard(profile, friendCount) {
            const formatChips = (amount) => {
                if (!amount) return '0';
                return amount.toLocaleString();
            };
            
            const bestHandDate = profile.best_hand_date 
                ? new Date(profile.best_hand_date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })
                : null;
            
            return `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">${profile.total_hands_played ?? 0}</div>
                        <div class="stat-label">Hands Played</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-value">${profile.total_rooms_played ?? 0}</div>
                        <div class="stat-label">Rooms Played</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-value">${profile.total_wins ?? 0}</div>
                        <div class="stat-label">Total Wins</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-value">${parseFloat(profile.win_rate || 0).toFixed(1)}%</div>
                        <div class="stat-label">Win Rate</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-value">${friendCount}</div>
                        <div class="stat-label">Friends</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-value">$${formatChips(profile.biggest_pot ?? 0)}</div>
                        <div class="stat-label">Biggest Pot</div>
                    </div>
                </div>
                
                ${profile.best_hand ? `
                    <div class="best-hand-section">
                        <h4>üèÜ Best Hand</h4>
                        <div class="best-hand-display">
                            <div class="hand-rank">${profile.best_hand}</div>
                            ${bestHandDate ? `<div class="hand-date">${bestHandDate}</div>` : ''}
                        </div>
                    </div>
                ` : ''}
            `;
        }
        
        async function loadHandHistory() {
            const container = document.getElementById('hand-history-list');
            const token = await window.authManager?.getAccessToken();
            
            if (!token) {
                container.innerHTML = '<div class="empty-state"><div class="empty-icon">üîê</div><h3>Authentication required</h3></div>';
                return;
            }
            
            try {
                container.innerHTML = '<div class="loading-state"><div class="loading-spinner"></div><p>Loading...</p></div>';
                
                const params = new URLSearchParams({ 
                    page: currentPage, 
                    limit: 20 
                });
                
                const response = await fetch(`/api/social/analytics/hands/${currentUser.id}?${params}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (!response.ok) throw new Error('Failed to fetch hands');
                
                const data = await response.json();
                let hands = data.hands || [];
                
                // Store all hands for quick lookup
                allHands = hands;
                
                // Apply filters
                console.log('Applying filters:', currentFilters, 'Hands before filter:', hands.length);
                if (currentFilters.won) {
                    hands = hands.filter(h => h.won === true);
                }
                if (currentFilters.lost) {
                    hands = hands.filter(h => h.won === false);
                }
                if (currentFilters.bigPot) {
                    hands = hands.filter(h => (h.potSize || h.pot_size || 0) >= 500);
                }
                console.log('Hands after filter:', hands.length);
                
                // Apply sort
                console.log('Applying sort:', currentSort);
                if (currentSort === 'oldest') {
                    hands = hands.sort((a, b) => {
                        const dateA = new Date(a.createdAt || a.created_at);
                        const dateB = new Date(b.createdAt || b.created_at);
                        return dateA - dateB;
                    });
                } else if (currentSort === 'pot-size') {
                    hands = hands.sort((a, b) => {
                        const potA = a.potSize || a.pot_size || 0;
                        const potB = b.potSize || b.pot_size || 0;
                        return potB - potA;
                    });
                } else {
                    // Default: most recent
                    hands = hands.sort((a, b) => {
                        const dateA = new Date(a.createdAt || a.created_at);
                        const dateB = new Date(b.createdAt || b.created_at);
                        return dateB - dateA;
                    });
                }
                
                // Render hands
                if (hands.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">üÉè</div>
                            <h3>No hands found</h3>
                            <p>Play some games to see your hand history here!</p>
                        </div>
                    `;
                } else {
                    container.innerHTML = hands.map(hand => createHandCard(hand)).join('');
                }
                
                // Update pagination
                updatePagination(data.pagination || { page: 1, totalPages: 1, total: hands.length });
                
            } catch (error) {
                console.error('Error loading hand history:', error);
                    container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">‚ö†Ô∏è</div>
                            <h3>Error loading hands</h3>
                            <p>Please try again later</p>
                        </div>
                    `;
                }
            }
        
        function createHandCard(hand) {
            // Handle both API response formats
            const createdAt = hand.createdAt || hand.created_at;
            const date = new Date(createdAt).toLocaleDateString('en-US', { 
                month: 'short', 
                day: 'numeric', 
                year: 'numeric' 
            });
            const time = new Date(createdAt).toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
                
            const isWinner = hand.won === true || hand.winner_id === currentUser.id;
            const wonClass = isWinner ? 'won' : 'lost';
            const resultIcon = isWinner ? 'üèÜ' : '‚ùå';
            const resultText = isWinner ? 'Won' : 'Lost';
            const resultColor = isWinner ? 'var(--teal)' : 'var(--orange)';
            
            // Decode hand if available
            let handPreview = '';
            const encodedHand = hand.encodedHand || hand.encoded_hand;
            if (encodedHand) {
                try {
                    const encoder = window.HandEncoder || (typeof HandEncoder !== 'undefined' ? HandEncoder : null);
                    if (encoder) {
                        const decoded = encoder.decode(encodedHand);
                        if (decoded && decoded.players && decoded.players.length > 0) {
                            // Find player with revealed cards (your cards)
                            const myPlayer = decoded.players.find(p => p.revealed && p.cards && p.cards.length === 2);
                            if (myPlayer && myPlayer.cards) {
                                handPreview = myPlayer.cards.map(c => getCardEmoji(c)).join(' ');
                            }
                        }
                    }
                } catch (e) {
                    console.error('Failed to decode hand:', e);
            }
        }
        
            return `
                <div class="hand-card ${wonClass}" onclick="viewHandDetails('${hand.id}')">
                    <div class="hand-card-header">
                        <div class="hand-card-date">
                            <span class="hand-date">${date}</span>
                            <span class="hand-time">${time}</span>
                        </div>
                        <div class="hand-card-result" style="color: ${resultColor}">
                            <span class="result-icon">${resultIcon}</span>
                            <span class="result-text">${resultText}</span>
                        </div>
                    </div>
                    
                    <div class="hand-card-body">
                        <div class="hand-info-row">
                            <div class="hand-info-item">
                                <span class="hand-label">Pot</span>
                                <span class="hand-value">$${(hand.potSize || hand.pot_size || 0).toLocaleString()}</span>
                            </div>
                            <div class="hand-info-item">
                                <span class="hand-label">Room</span>
                                <span class="hand-value">${hand.roomName || hand.room_name || 'Unknown'}</span>
                            </div>
                            <div class="hand-info-item">
                                <span class="hand-label">Hand #</span>
                                <span class="hand-value">${hand.handNumber || hand.hand_number || 'N/A'}</span>
                            </div>
                        </div>
                        
                        ${handPreview ? `
                            <div class="hand-cards-preview">
                                <span class="cards-label">Your Cards:</span>
                                <span class="cards-display">${handPreview}</span>
                            </div>
                        ` : ''}
                        
                        ${(hand.winningHand || hand.winning_hand) ? `
                            <div class="hand-winning-hand">
                                <span class="winning-label">Winning Hand:</span>
                                <span class="winning-value">${hand.winningHand || hand.winning_hand}</span>
                            </div>
                        ` : ''}
                    </div>
                    
                    <div class="hand-card-footer">
                        <button class="view-hand-btn" onclick="event.stopPropagation(); viewHandDetails('${hand.id}')">View Details ‚Üí</button>
                    </div>
                </div>
            `;
        }
        
        function getCardEmoji(card) {
            const suits = { 'H': '‚ô•Ô∏è', 'D': '‚ô¶Ô∏è', 'C': '‚ô£Ô∏è', 'S': '‚ô†Ô∏è' };
            const ranks = { 'A': 'A', 'K': 'K', 'Q': 'Q', 'J': 'J', 'T': '10' };
            const suit = card[1] || card.slice(-1);
            const rank = card[0] || card.slice(0, -1);
            return `${ranks[rank] || rank}${suits[suit] || suit}`;
        }
        
        function updatePagination(pagination) {
            const btnPrev = document.getElementById('btn-prev');
            const btnNext = document.getElementById('btn-next');
            const pageInfo = document.getElementById('page-info');
            
            if (btnPrev && btnNext && pageInfo) {
                btnPrev.disabled = pagination.page <= 1;
                btnNext.disabled = pagination.page >= pagination.totalPages;
                pageInfo.textContent = `Page ${pagination.page} of ${pagination.totalPages}`;
            }
        }
        
        async function viewHandDetails(handId) {
            console.log('View hand details:', handId);
            
            // Find hand from stored array first
            let hand = allHands.find(h => h.id === handId);
            
            // If not found, fetch it
            if (!hand) {
                const token = await window.authManager?.getAccessToken();
                if (!token) return;
                
                try {
                    const response = await fetch(`/api/social/analytics/hands/${currentUser.id}?limit=100`, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    
                    if (!response.ok) throw new Error('Failed to fetch hand');
                    
                    const data = await response.json();
                    hand = data.hands.find(h => h.id === handId);
                    
                    if (!hand) {
                        console.error('Hand not found:', handId);
                        alert('Hand not found');
                        return;
                    }
                } catch (error) {
                    console.error('Error loading hand details:', error);
                    alert('Failed to load hand details');
                    return;
                }
            }
            
            // Decode hand
            const encodedHand = hand.encodedHand || hand.encoded_hand;
            let decoded = null;
            if (encodedHand) {
                try {
                    // Try window.HandEncoder first, then global HandEncoder
                    const encoder = window.HandEncoder || (typeof HandEncoder !== 'undefined' ? HandEncoder : null);
                    if (encoder) {
                        decoded = encoder.decode(encodedHand);
                    } else {
                        console.warn('HandEncoder not available');
                    }
                } catch (e) {
                    console.error('Failed to decode hand:', e);
                }
            }
            
            // Show modal
            showHandDetailsModal(hand, decoded);
        }
        
        function showHandDetailsModal(hand, decoded) {
            // Create modal HTML
            const modal = document.createElement('div');
            modal.className = 'hand-details-modal';
            modal.innerHTML = `
                <div class="hand-details-overlay" onclick="closeHandDetailsModal()"></div>
                <div class="hand-details-content">
                    <div class="hand-details-header">
                        <h2>Hand Details</h2>
                        <button class="hand-details-close" onclick="closeHandDetailsModal()">√ó</button>
                    </div>
                    
                    <div class="hand-details-body">
                        ${renderHandDetails(hand, decoded)}
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            document.body.style.overflow = 'hidden';
        }
        
        function renderHandDetails(hand, decoded) {
            const date = new Date(hand.createdAt || hand.created_at).toLocaleString();
            const isWinner = hand.won === true;
            
            let html = `
                <div class="hand-details-summary">
                    <div class="detail-row">
                        <span class="detail-label">Date & Time</span>
                        <span class="detail-value">${date}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Room</span>
                        <span class="detail-value">${hand.roomName || hand.room_name || 'Unknown'}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Hand #</span>
                        <span class="detail-value">${hand.handNumber || hand.hand_number || 'N/A'}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pot Size</span>
                        <span class="detail-value">$${(hand.potSize || hand.pot_size || 0).toLocaleString()}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Result</span>
                        <span class="detail-value ${isWinner ? 'won' : 'lost'}">${isWinner ? 'üèÜ Won' : '‚ùå Lost'}</span>
                    </div>
                    ${hand.winningHand || hand.winning_hand ? `
                        <div class="detail-row">
                            <span class="detail-label">Winning Hand</span>
                            <span class="detail-value">${hand.winningHand || hand.winning_hand}</span>
                        </div>
                    ` : ''}
                </div>
            `;
            
            if (decoded) {
                // Your cards - find revealed cards (winner's cards are revealed, or yours if you won)
                const revealedPlayer = decoded.players.find(p => p.revealed && p.cards && p.cards.length === 2);
                
                // If you won, the revealed cards are yours
                if (isWinner && revealedPlayer && revealedPlayer.cards) {
                    html += `
                        <div class="hand-details-section">
                            <h3>Your Cards</h3>
                            <div class="cards-display-large">
                                ${revealedPlayer.cards.map(c => `<span class="card-large">${formatCard(c)}</span>`).join('')}
                            </div>
                        </div>
                    `;
                } else if (revealedPlayer && revealedPlayer.cards) {
                    // Show winner's cards
                    html += `
                        <div class="hand-details-section">
                            <h3>Winner's Cards (Seat ${revealedPlayer.seatIndex})</h3>
                            <div class="cards-display-large">
                                ${revealedPlayer.cards.map(c => `<span class="card-large">${formatCard(c)}</span>`).join('')}
                            </div>
                        </div>
                    `;
            }
                
                // Board cards
                if (decoded.board && decoded.board.length > 0) {
                    html += `
                        <div class="hand-details-section">
                            <h3>Board</h3>
                            <div class="cards-display-large">
                                ${decoded.board.map(c => `<span class="card-large">${formatCard(c)}</span>`).join('')}
                            </div>
                        </div>
                    `;
                }
                
                // Actions by street
                if (decoded.actions && decoded.actions.length > 0) {
                    const actionsByStreet = {};
                    decoded.actions.forEach(action => {
                        const street = action.street || 'PREFLOP';
                        if (!actionsByStreet[street]) {
                            actionsByStreet[street] = [];
                        }
                        actionsByStreet[street].push(action);
                    });
                    
                    // Street display order
                    const streetOrder = ['PREFLOP', 'FLOP', 'TURN', 'RIVER'];
                    const orderedStreets = streetOrder.filter(s => actionsByStreet[s]);
                    
                    html += `
                        <div class="hand-details-section">
                            <h3>Actions</h3>
                            ${orderedStreets.map(street => `
                                <div class="street-actions">
                                    <h4>${street}</h4>
                                    <div class="actions-list">
                                        ${actionsByStreet[street].map(action => {
                                            const actionType = action.action || 'UNKNOWN';
                                            const actionDisplay = actionType.charAt(0).toUpperCase() + actionType.slice(1).toLowerCase();
                                            return `
                                                <div class="action-item">
                                                    <span class="action-seat">Seat ${action.seatIndex}</span>
                                                    <span class="action-type">${actionDisplay}</span>
                                                    ${action.amount > 0 ? `<span class="action-amount">$${action.amount}</span>` : ''}
                                                </div>
                                            `;
                                        }).join('')}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
                
                // Dealer position
                if (decoded.dealerPosition !== null && decoded.dealerPosition !== undefined) {
                    html += `
                        <div class="hand-details-section">
                            <h3>Position</h3>
                            <div class="detail-row">
                                <span class="detail-label">Dealer (BTN)</span>
                                <span class="detail-value">Seat ${decoded.dealerPosition}</span>
                            </div>
                        </div>
                    `;
                }
                
                // Starting stacks
                if (decoded.startingStacks && Object.keys(decoded.startingStacks).length > 0) {
                    html += `
                        <div class="hand-details-section">
                            <h3>Starting Stacks</h3>
                            <div class="stacks-list">
                                ${Object.entries(decoded.startingStacks).map(([seat, stack]) => `
                                    <div class="stack-item">
                                        <span>Seat ${seat}:</span>
                                        <span>$${stack.toLocaleString()}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }
                
                // All players (if available)
                if (decoded.players && decoded.players.length > 0) {
                    html += `
                        <div class="hand-details-section">
                            <h3>Players</h3>
                            <div class="players-list">
                                ${decoded.players.map(p => `
                                    <div class="player-item">
                                        <span class="player-seat">Seat ${p.seatIndex}</span>
                                        <span class="player-cards">
                                            ${p.revealed && p.cards ? p.cards.map(c => formatCard(c)).join(' ') : '[Mucked]'}
                                        </span>
                                        ${p.seatIndex === decoded.winner ? '<span class="player-winner">üèÜ Winner</span>' : ''}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }
            } else {
                html += `
                    <div class="hand-details-section">
                        <p class="no-details">Hand details not available (legacy format)</p>
                        </div>
                    `;
                }
            
            return html;
        }
        
        function formatCard(card) {
            const suits = { 'H': '‚ô•Ô∏è', 'D': '‚ô¶Ô∏è', 'C': '‚ô£Ô∏è', 'S': '‚ô†Ô∏è' };
            const rank = card[0] || card.slice(0, -1);
            const suit = card[1] || card.slice(-1);
            return `${rank}${suits[suit] || suit}`;
        }
        
        function closeHandDetailsModal() {
            const modal = document.querySelector('.hand-details-modal');
            if (modal) {
                modal.remove();
                document.body.style.overflow = '';
            }
        }
        
        window.viewHandDetails = viewHandDetails;
        window.closeHandDetailsModal = closeHandDetailsModal;
    </script>
</body>
</html>
